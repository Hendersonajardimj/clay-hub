---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async () => {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content } = await post.render();

const archetypeLabels = {
  'rack-breakdown': 'Ableton Rack Breakdown',
  'track-deconstruction': 'Track Deconstruction',
  'dj-workflow': 'DJ Workflow',
  'field-recording': 'Field Recording to Texture'
};

const difficultyColors = {
  beginner: 'text-green-500',
  intermediate: 'text-yellow-500',
  advanced: 'text-red-500'
};
---

<BaseLayout
  title={`${post.data.title} - CLAY`}
  description={post.data.excerpt}
  image={post.data.coverImage}
>
  <article class="container mx-auto px-4 py-16">
    <div class="max-w-3xl mx-auto">
      <!-- Back link -->
      <a href="/writing" class="inline-block text-sm uppercase tracking-wider accent-hover mb-8">
        ‚Üê Back to Writing
      </a>

      <!-- Post Header -->
      <header class="mb-12">
        <div class="flex flex-wrap items-center gap-3 mb-4">
          <span class="text-xs uppercase tracking-wider px-3 py-1 bg-[--accent]/20 text-[--accent] border border-[--accent]/30">
            {archetypeLabels[post.data.archetype]}
          </span>
          <span class={`text-xs uppercase tracking-wider ${difficultyColors[post.data.difficulty]}`}>
            {post.data.difficulty}
          </span>
          <time class="text-xs text-[--text-muted] uppercase tracking-wider">
            {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
          </time>
        </div>

        <h1 class="text-4xl md:text-5xl font-bold mb-4">{post.data.title}</h1>
        <p class="text-xl text-[--text-secondary] leading-relaxed">{post.data.excerpt}</p>

        {post.data.tools && post.data.tools.length > 0 && (
          <div class="mt-6 pt-6 border-t border-neutral-800">
            <p class="text-xs text-[--text-muted] uppercase tracking-wider mb-3">Tools Used</p>
            <div class="flex flex-wrap gap-3">
              {post.data.tools.map((tool) => (
                <span class="text-sm px-3 py-1 bg-[--bg-card] border border-neutral-800">
                  {tool}
                </span>
              ))}
            </div>
          </div>
        )}

        {post.data.coverImage && (
          <img
            src={post.data.coverImage}
            alt={post.data.title}
            class="w-full aspect-video object-cover card mt-8"
          />
        )}
      </header>

      <!-- Post Content -->
      <div class="prose-content max-w-none">
        <Content />
      </div>

      <!-- Post Footer -->
      {post.data.series && (
        <div class="mt-12 pt-8 border-t border-neutral-800">
          <p class="text-sm text-[--text-muted] mb-2">Part of the series:</p>
          <a href={`/writing?series=${post.data.series}`} class="text-lg font-bold accent-hover">
            {post.data.series}
          </a>
        </div>
      )}
    </div>
  </article>
</BaseLayout>
